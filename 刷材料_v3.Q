[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=122
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=d3b277c2-873d-4540-8591-26e038892ae6
Description=刷材料_v3
Enable=0
AutoRun=0
[Repeat]
Type=1
Number=1
[SetupUI]
Type=2
QUI=
[Relative]
SetupOCXFile=
[Comment]

[Attachment]
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


[Script]
//******** Windows
hwnd = Plugin.Window.Find("Ragnarok", "Ragnarok")
Call Plugin.Window.Move(hwnd, 0, 0)

//******** User Parameters
UserVar gScriptAuthor = DropList{"Wade.Yeh":1}=1 "Author"
UserVar gScriptVersion = DropList{"20220728A":1}=1 "Version"
/* Note
20200728A
1. Add gEnableFuzzy and gDelayFuzzyPercent to add some fuzzy at delays
*/
UserVar gEnableFuzzy = DropList{"Enable":1 | "Disable":0}=1 "Enable Fuzzy"
//**** Keys
UserVar gRecoveryKey = "1" "Recovery Key"
UserVar gFlyKey = "2" "Fly Key"
UserVar gSkillKey1 = "E" "Skill 1 Key(0-9 A-Z)"
UserVar gSkillKey2 = "E" "Skill 1 Key(0-9 A-Z)"

//**** Delay
UserVar gLoopDelay = 50 "Loop Delay(ms)"
UserVar gFlyDelay = 500 "Fly Delay(ms)"
UserVar gSkill1Delay = 900 "Skill 1 Delay(ms)"
UserVar gSkill2Delay = 900 "Skill 2 Delay(ms)"
UserVar gDelayFuzzyPercent = 50 "Delay Fuzzy(%)"

//**** Loop
UserVar gSkill1Loop = 3 "Skill 1 Loop"
UserVar gSkill2Loop = 0 "Skill 2 Loop"
UserVar gLoopRecovery = 3 "Loop and Recovery"

//****Verify
UserVar gEnableVerify = DropList{"Enable":1 | "Disable":0}=1 "Enable Verify"
UserVar gVerifyTime = 1 "Check Veritication every n min"

//******** Parameters
Dim cTrue
cTrue = 1
Dim cFalse
cFalse = 0
//**** Coordinate
gDelta = 1
gBackButtomXY = array(1507, 123)
gStringTryCount = 10
gString1Coordinate = array(23-gDelta, 386-gDelta, 93+gDelta, 396+gDelta)	// LUX, LUY, RDX, RDY	// String1: 外掛驗證裝置
// gString2Coordinate = array(21-gDelta, 212-gDelta, 163+gDelta, 222+gDelta)	// LUX, LUY, RDX, RDY	// String2: 您現在不需要進行驗證
gString3Coordinate = array(21-gDelta, 212-gDelta, 127+gDelta, 222+gDelta)	// LUX, LUY, RDX, RDY	// String3: 您好請您輸入外掛驗證
gVerifyCodeCoordinate = array(75-gDelta, 303-gDelta, 109+gDelta, 311+gDelta)	// LUX, LUY, RDX, RDY
gVCodeNumDelta = 6
gVCodeNumTryCount = 1
gVCodeNum = array(75-gDelta, 303-gDelta, 79+gDelta, 311+gDelta)	// LUX, LUY, RDX, RDY

Dim gVerifyTimerInitial
Dim gVerifyTimerCurrent

Function findCoordinateNum(uLUX, uLUY, uRDX, uRDY, uNum)
	Dim uWBreak
	Dim uTargetString
	Dim uResult
	uResult = cFalse
	uNum = CStr(uNum)
	uTargetString = "Attachment:\"+uNum+".bmp"
	
	uWBreak=gVCodeNumTryCount
	While(uWBreak>0)
		FindPic uLUX, uLUY, uRDX, uRDY, uTargetString, 1, intX, intY
		If intX > 0 And intY > 0 Then
    		TracePrint "Find: "+uNum+".bmp"
    		uWBreak = 0
    		uResult = cTrue
    	// Else 
    	//	TracePrint "Not Found: "+uNum+".bmp"
		End If
		Delay 25
		uWBreak = uWBreak - 1
	Wend
	findCoordinateNum = uResult
End Function

Function mainFunction()
	Dim uVerifyStatus
	If (gEnableFuzzy = 0) Then 
		gDelayFuzzyPercent=0
	End If
	uVerifyStatus=0 // 0: Wait
	gVerifyTimerInitial = Plugin.GetSysInfo.GetTime
	gVerifyTimerCurrent = Plugin.GetSysInfo.GetTime
	While (1)
		//**** Fly and Attack
		For gLoopRecovery
			Call Plugin.Bkgnd.KeyPress(hwnd, Asc(gFlyKey))
			Delay CInt(gFlyDelay * (100 + (Rnd * gDelayFuzzyPercent * 2 - gDelayFuzzyPercent)) / 100)
			
			For gSkill1Loop
				Call Plugin.Bkgnd.KeyPress(hwnd, Asc(gSkillKey1))
				Delay CInt(gSkill1Delay * (100 + (Rnd * gDelayFuzzyPercent * 2 - gDelayFuzzyPercent)) / 100)
			Next
			
			For gSkill2Loop
				Call Plugin.Bkgnd.KeyPress(hwnd, Asc(gSkil2Key1))
				Delay CInt(gSkill2Delay * (100 + (Rnd * gDelayFuzzyPercent * 2 - gDelayFuzzyPercent)) / 100)
			Next
		Next
		//**** Recovery
		Call Plugin.Bkgnd.KeyPress(hwnd, Asc(gRecoveryKey))
		
		If (gEnableVerify=1) Then 
			gVerifyTimerCurrent = Plugin.GetSysInfo.GetTime
			If ((gVerifyTimerCurrent - gVerifyTimerInitial) >= (gVerifyTime * 60 * 1000)) Then 
    			TracePrint "Check Verify."
				uVerifyStatus = 1
			End If
		End If
		
		//**** Check Verify
		If (uVerifyStatus>0) Then 
			Dim uWBreak
			//** Click "Back" Buttom
			MoveTo gBackButtomXY(0), gBackButtomXY(1)
			Delay 100
			LeftClick 1
			uVerifyStatus=2	// 2: To find "外掛驗證裝置"
			Delay 250
			//** 尋找"外掛驗證裝置"
			If (uVerifyStatus = 2) Then 
				uWBreak=gStringTryCount
				While(uWBreak>0)
					FindPic gString1Coordinate(0),gString1Coordinate(1),gString1Coordinate(2),gString1Coordinate(3),"Attachment:\外掛驗證裝置.bmp",0.9,intX,intY
					If intX > 0 And intY > 0 Then
    					TracePrint "Find: 外掛驗證裝置."
    					uWBreak = 0
    					uVerifyStatus = 3 // 3: Click "Enter"
    				Else 
    					TracePrint "Not Found: 外掛驗證裝置."
					End If	
					Delay 25
					uWBreak = uWBreak - 1
				Wend
			End If
			
			If (uVerifyStatus = 3) Then 
				Call Plugin.Bkgnd.KeyPress(hwnd, 13)
				uVerifyStatus = 4 // 4: To find "您好請您輸入外掛驗證"
			End If
			
			//** 尋找"您好請您輸入外掛驗證"
			If (uVerifyStatus = 4) Then 
				uWBreak=gStringTryCount
				While(uWBreak>0)
					FindPic gString3Coordinate(0),gString3Coordinate(1),gString3Coordinate(2),gString3Coordinate(3),"Attachment:\您好請您輸入外掛驗證.bmp",0.9,intX,intY
					If intX > 0 And intY > 0 Then
    					TracePrint "Find: 您好請您輸入外掛驗證."
    					uWBreak=0
    					uVerifyStatus = 5 // 5: To Decode the code"
    				Else 
    					TracePrint "Not Found: 您好請您輸入外掛驗證."
					End If
					Delay 25
					uWBreak = uWBreak - 1
					If (uWBreak = 0) Then 
						Call Plugin.Bkgnd.KeyPress(hwnd, 13)
						uVerifyStatus=0
						gVerifyTimerInitial = Plugin.GetSysInfo.GetTime
						gVerifyTimerCurrent = gVerifyTimerInitial
					End If
				Wend
			End If
			
			//** Decode the code
			If (uVerifyStatus = 5) Then 
				Dim uPlaceIndex
				Dim uNumIndex
				Dim uResult
				Dim uLUX
				Dim uLUY
				Dim uRDX
				Dim uRDY
				
				For (6)
					uLUX = gVCodeNum(0) + uPlaceIndex * gVCodeNumDelta
					uLUY = gVCodeNum(1)
					uRDX = gVCodeNum(2) + uPlaceIndex * gVCodeNumDelta
					uRDY = gVCodeNum(3)
					uNumIndex=0
					For (10)
						uResult = findCoordinateNum(uLUX, uLUY, uRDX, uRDY, uNumIndex)
						If (uResult = cTrue) Then 
							TracePrint "Enter Number "+CStr(uNumIndex)
							Call Plugin.Bkgnd.KeyPress(hwnd, Asc(uNumIndex))
							Exit For
						End If
						uNumIndex=uNumIndex+1
					Next
					uPlaceIndex=uPlaceIndex+1
				Next
				Delay 50
				Call Plugin.Bkgnd.KeyPress(hwnd, 13)
				Delay 150
				Call Plugin.Bkgnd.KeyPress(hwnd, 13)
				Delay 50
				uVerifyStatus=0
				gVerifyTimerInitial = Plugin.GetSysInfo.GetTime
				gVerifyTimerCurrent = gVerifyTimerInitial
			End If
			
			//** Timeout(2 * gVerifyTime min)
			gVerifyTimerCurrent = Plugin.GetSysInfo.GetTime
			If ((gVerifyTimerCurrent - gVerifyTimerInitial) >= (2 * gVerifyTime * 60 * 1000)) Then 
				uVerifyStatus=0
				gVerifyTimerInitial = Plugin.GetSysInfo.GetTime
				gVerifyTimerCurrent = gVerifyTimerInitial
			End If
		End If
		
		Delay CInt(gLoopDelay * (100 + (Rnd * gDelayFuzzyPercent * 2 - gDelayFuzzyPercent)) / 100)
	Wend
End Function


Call mainFunction()
